<template>
    <main>
        <ui-main-top-slider style="width: 70%" />

        
        
        <div class="right_screens">
            <img src="@/assets/img/img_top.png" alt="">
            <img src="@/assets/img/Banner2.png" alt="">
        </div>
    </main>

    <mini-products-slider 
    class="main_bottom_slider"
    
    >
        <SplideSlide>
            <img src="@/assets/img/main_bottom_slide1.png" alt="">
        </SplideSlide>
        <SplideSlide>
            <img src="@/assets/img/Banner1.png" alt="">
        </SplideSlide>
        <SplideSlide>
            <img src="@/assets/img/main_bottom_slide3.png" alt="">
        </SplideSlide>
        <SplideSlide>
            <img src="@/assets/img/main_bottom_slide4.png" alt="">
        </SplideSlide>
        <SplideSlide>
            <img src="@/assets/img/main_bottom_slide2.png" alt="">
        </SplideSlide>
    </mini-products-slider>
    
    <ui-our-procs />

    <div class="variety_of_products">
        <h1>–®–∏—Ä–æ–∫–∏–π –∞—Å—Å–æ—Ä—Ç–∏–º–µ–Ω—Ç —Ç–æ–≤–∞—Ä–æ–≤</h1><br>
        <span>–¥–ª—è –º–∞–ª—ã—à–µ–π –∏ –º–∞–º</span>
        <div class="for_grid">
            <div 
            class="category_box" 
            v-for="center_category in center_categories"
            @click="toFiltersPage(center_category.name)"
            >
                <img :src="$store.getters.getImageUrl(center_category.image)"><br>
                <span>{{ center_category.name }}</span>
            </div>
        </div>
    </div>
    
    <mini-products-slider>
        <template #header>
            <h1>–ê–∫—Ü–∏–∏ –∏ —Å–∫–∏–¥–∫–∏</h1>
        </template>
        
        <ui-slide
        v-for="product in sailed_products"
        :key="product.id"
        :product="product"
        >
        </ui-slide>
    </mini-products-slider>

    <div class="get_sales_info_form_box">
        <img src="@/assets/img/sale_kupon.png">
        <img src="@/assets/img/sale_circle.png">
        <div class="form_wrapper" action="">
            <div style="width:80%">
                <h1>–ü–æ–ª—É—á–∞–π—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∫–∏–¥–∫–∞—Ö –ø–µ—Ä–≤—ã–º–∏</h1>
                <span>–û—Ñ–æ—Ä–º–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ —Ä–∞—Å—Å—ã–ª–∫—É(–º–æ–∂–Ω–æ –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏) –∏ –≤—ã –±—É–¥–µ—Ç–µ –≤–∫—É—Ä—Å–µ –≤—Å–µ—Ö –Ω–∞—à–∏—Ö –Ω–æ–≤—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤</span>
                <form @submit.prevent method="post">
                    <div style="width: 45%;position: relative;">
                        <input ref="mail_to_mailing_list" type="email" placeholder="–í–∞—à–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞" />
                        <div 
                        v-if="mailing_list_response" 
                        :class="{
                            response_msg: true,
                            response_msg_invalid: mailing_list_response_invalid,
                            response_msg_valid: mailing_list_response_valid
                        }"
                        >
                            {{ mailing_list_response }}
                        </div>
                    </div>
                    <button @click="subscribeMailingList">
                        <strong>&#10003; –û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</strong>
                    </button>
                    <button @click="unsubscribe">
                        <strong>&#10005; –û—Ç–∫–∞–∑–∞—Ç—Å—è –æ—Ç –ø–æ–¥–ø–∏—Å–∫–∏</strong>
                    </button>
                </form>
            </div>
            
        </div>
        <img class="right_girl" src="@/assets/img/form_right_girl.png" alt="">
    </div>

    <mini-products-slider>
        <template #header>
            <h1>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</h1>
        </template>
        
        <ui-slide
        v-for="product in hit_products"
        :key="product.id"
        :product="product"
        >
        </ui-slide>
    </mini-products-slider>

    <mini-products-slider style="background: #F4F5F9;">
        <template #header>
            <h1>–ù–æ–≤–∏–Ω–∫–∏</h1>
        </template>
        
        <ui-slide
        v-for="product in new_products"
        :key="product.id"
        :product="product"
        >
        </ui-slide>
        

    </mini-products-slider>

    <div class="about_us">
        <div class="content">
            <div class="in_line">
                <h1>–û –Ω–∞—Å</h1> 
                <img src="@/assets/img/Logo2.png" alt=""> 
            </div>
            <p>
                <strong>Bƒìrnu veikals</strong>¬†‚Äî —ç—Ç–æ –æ–≥—Ä–æ–º–Ω—ã–π –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω –¥–ª—è –º–∞–ª—ã—à–µ–π –∏¬†–∏—Ö¬†—Ä–æ–¥–∏—Ç–µ–ª–µ–π.
                –î–ª—è –Ω–∞—Å –≥–ª–∞–≤–Ω—ã–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç¬†‚Äî —ç—Ç–æ –∫–æ–º—Ñ–æ—Ä—Ç –∏¬†–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –¥–ª—è –í–∞—Å –∏¬†–í–∞—à–∏—Ö –¥—Ä–∞–≥–æ—Ü–µ–Ω–Ω—ã—Ö –∫—Ä–æ—à–µ–∫ ‚ô•.
                –ù–∞—à –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω –≤—Å–µ–≥–¥–∞ –ø–æ–¥ —Ä—É–∫–æ–π –∏¬†–í—ã¬†–≤¬†–ª—é–±–æ–µ –≤—Ä–µ–º—è —Å—É—Ç–æ–∫ –º–æ–∂–µ—Ç–µ –∑–∞–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–≤–∞—Ä—ã,
                –∫–æ—Ç–æ—Ä—ã–µ –º—ã¬†–Ω–∞–∏–±–æ–ª–µ–µ –±—ã—Å—Ç—Ä—ã–º –∏¬†—É–¥–æ–±–Ω—ã–º –¥–ª—è –í–∞—Å —Å–ø–æ—Å–æ–±–æ–º –¥–æ—Å—Ç–∞–≤–∏–º –ø–æ¬†–≤—Å–µ–π —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –ë–∞–ª—Ç–∏–∏.
                Bƒìrnu Veikals –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–æ–ª—å—à–∏–º –≤—ã–±–æ—Ä–æ–º —Ç–æ–≤–∞—Ä–æ–≤ –Ω–∞–∏–ª—É—á—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ¬†–¥–æ—Å—Ç—É–ø–Ω—ã–º —Ü–µ–Ω–∞–º,
                –º—ã¬†–∑–∞–±–æ—Ç–∏–º—Å—è –Ω–µ¬†—Ç–æ–ª—å–∫–æ –æ¬†–∫–∞—á–µ—Å—Ç–≤–µ, –Ω–æ¬†–∏¬†–æ¬†–≤–∞—à–µ–º –∫–æ—à–µ–ª—å–∫–µ üëõ.
            </p>
            <strong class="read_detail" @click="$router.push('/about')">
                –ß–∏—Ç–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ &nbsp; &nbsp; 
                <img src="@/assets/img/arrow_5.png" alt="">
            </strong>
        </div>
        <div class="images_box">
            <img src="@/assets/img/portrait-pretty-mother-with-shopping-package-walking-with-baby-carriage-incity-center_1.png" alt="">
        </div>
    </div>

    <ui-brands 
    :brands="brands_index"
    />

    <ContactUsBox />

    <ui-href-blog-box />

    
    
</template>

<script setup>
import axios from 'axios'
import { useRouter } from 'vue-router'
import { useStore } from 'vuex'
import { ref, reactive, onBeforeMount } from 'vue'


const store = useStore()
const router = useRouter()

const center_categories = reactive([])
const sailed_products = reactive([])
const hit_products = reactive([])
const new_products = reactive([])
const brands_index = reactive([])
const mailing_list_response = ref('')
const mailing_list_response_valid = ref(false)
const mailing_list_response_invalid = ref(false)
const mail_to_mailing_list = ref(null)


onBeforeMount(async () => {
    center_categories.push(...await store.dispatch('fetchPositionCategories', 'center'))
    sailed_products.push(...await store.dispatch('fetchProductsBySaleNewHit', 'sale'))
    new_products.push(...await store.dispatch('fetchProductsBySaleNewHit', 'NEW'))
    hit_products.push(...await store.dispatch('fetchProductsBySaleNewHit', 'HIT'))
    brands_index.push(...await store.dispatch('fetchBrandsIndex'))
})


function check_mailing_list_response(response){
    if(response.data['Error']){
        mailing_list_response_invalid.value = true
        mailing_list_response.value = response.data['Error']
        setTimeout(() => {
            mailing_list_response_invalid.value = false
            mailing_list_response.value = ''
        }, 4000);
    }
    else if(response.data['Message']){
        mailing_list_response_valid.value = true
        mailing_list_response.value = 'Loading...'
        mailing_list_response.value = response.data['Message']
        setTimeout(() => {
            mailing_list_response_valid.value = false
            mailing_list_response.value = ''
        }, 4000)
    }
}
function invalid_email_ui(){
    mail_to_mailing_list.value.style = "border: 2px solid red"
    setTimeout(()=>{
        // Validation below used to avoid error when user
        // after submit with empty email try go to other page 
        if (mail_to_mailing_list.value) mail_to_mailing_list.value.style = ""
    }, 4000)
}
async function subscribeMailingList(){
    const mail = mail_to_mailing_list.value.value.trim()
    if (!mail) {
        invalid_email_ui()
        return
    }

    const response = await axios.post(`${store.state.server_href}mailing_list`, {mail:mail})
    check_mailing_list_response(response)
}
async function unsubscribe(){
    const mail = mail_to_mailing_list.value.value.trim()
    if (!mail) {
        invalid_email_ui()
        return
    }
    
    const response = await axios.post(`${store.state.server_href}mailing_list`, {mail:mail, for_delete:true})
    check_mailing_list_response(response)
}
function toFiltersPage(center_category){
    // find center cat in localStorage cats_formated and redirect to
    // filters page with center cat name and parent cat name 
    const cats_formated = JSON.parse(localStorage.getItem('cats_formated'))
    for(const [lcat_key, lcat_value] of Object.entries(cats_formated)){
        if (Object.keys(lcat_value).find( el => el==center_category )) {
            router.push({ path:'/product_filters', query:{'center_category': `${lcat_key},${center_category}`} })
            break
        }
    }
}


</script>

<style>
    @import url("@/assets/css/index.css");
</style>
